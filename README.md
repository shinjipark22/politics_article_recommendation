# 📰 네이버 정치 뉴스 자동 수집기 (Naver Politics News Crawler)

Apache Airflow를 사용하여 네이버 뉴스 '정치' 섹션의 기사들을 매일 자동으로 수집하고, 분석 가능한 데이터(CSV)로 저장하는 데이터 파이프라인 프로젝트입니다.
추후 그래프 기반 뉴스 추천 시스템 확장을 위해 핵심 로직이 모듈화(`src`)되어 있습니다.

## 📌 주요 기능 (Key Features)

* **자동화된 파이프라인**: Airflow DAG를 통해 매일 자정(`@daily`)에 자동으로 크롤링이 수행됩니다.
* **상세 데이터 수집**: 단순 제목/링크뿐만 아니라 **본문(Content), 기자명, 언론사, 기사 작성/수정 시간, 뉴스 ID** 등 상세 정보를 수집합니다.
* **데이터 정제**: 뉴스 본문 내의 불필요한 HTML 태그, 광고 스크립트, 공백 등을 제거하여 분석하기 좋은 형태로 가공합니다.
* **모듈화된 구조**: 스케줄링(`dags`)과 핵심 로직(`src`)을 분리하여 유지보수성과 확장성을 높였습니다.
* **과거 데이터 수집 (Backfill)**: `catchup=True` 설정을 통해 설정된 시작 날짜부터 현재까지 누락된 데이터를 자동으로 수집합니다.
* **CSV 저장**: 수집된 데이터는 날짜별로 `data/` 폴더에 저장되며, 엑셀 깨짐 방지(`utf-8-sig`) 처리가 되어 있습니다.


## 📂 프로젝트 구조 (Project Structure)

```bash
politics_article_recommendation_project/
├── dags/
│   └── politics_news_dag.py  # Airflow DAG 정의 (스케줄링 담당)
├── src/                      # [Core] 핵심 로직 모듈
│   ├── news_crawler.py       # 네이버 뉴스 상세 크롤링 로직
│   ├── preprocessor.py       # 텍스트 전처리 및 정제 유틸리티
│   └── graph/                # (예정) 그래프 임베딩 및 모델링 폴더
├── data/                     # 수집된 CSV 파일이 저장되는 곳 (자동 생성)
├── requirements.txt          # 의존성 패키지 목록
├── .gitignore                # Git 제외 설정
└── README.md                 # 프로젝트 설명서
```

## 🛠️ 데이터 전처리 상세 (Data Preprocessing)

수집된 원본 뉴스 데이터를 LLM 분석 및 그래프 데이터베이스 구축에 최적화된 형태로 가공하기 위해 `src/preprocessor.py`를 통해 다음과 같은 정밀 전처리를 수행합니다.

### 1. 텍스트 정제 및 노이즈 제거 (Noise Removal)
* **메타데이터 및 방송 태그 제거**: 본문 내 포함된 `[앵커]`, `[리포트]`, `(서울=연합뉴스)`, `<저작권자...>` 등 기사 맥락과 무관한 방송용 태그와 출처 표기를 정규표현식으로 완벽히 제거합니다.
* **이메일 및 기자 패턴 정제**: 본문 중간이나 끝에 삽입된 기자의 이메일 주소와 도입부의 `홍길동 기자 =` 와 같은 불필요한 뉴스 작성자 패턴을 제거합니다.
* **문맥 보존형 기호 정제**: LLM이 문맥을 정확히 파악할 수 있도록 문장 부호(`.`, `,`, `?`, `!`)와 인용구(`"`, `'`), 수치(`%`) 등은 남기고, 분석에 불필요한 특수 기호(`▶`, `※`, `-`, `=`, `+` 등)만 선택적으로 제거합니다.
* **텍스트 정규화**: 다중 공백 및 줄바꿈을 단일 공백으로 치환(`re.sub(r'\s+', ' ', text)`)하여 텍스트 밀도를 높임으로써 LLM 토큰 효율성을 극대화합니다.


### 2. 기자명 정규화 (Reporter Name Normalization)
* **그래프 노드 통일성 확보**: 그래프 데이터베이스 구축 시 인물 노드의 중복을 방지하기 위해 `기자`, `특파원`, `논설위원`, `앵커` 등 직함을 제거하고 순수 성명(예: '김동성')만 추출하여 정규화합니다.
* **불순물 필터링**: 성명 뒤에 붙은 이메일이나 특수문자, 숫자 등을 제거하여 데이터의 정합성을 확보합니다.


### 3. 데이터 무결성 및 파이프라인 연동
* **물리적 경로 분리**: Airflow와의 안정적인 연동을 위해 `data/raw`의 원본을 읽어 전처리 후 `data/processed`에 별도 저장하는 구조를 채택하여 데이터 유실을 방지합니다.
* **품질 검증 및 인코딩**: 본문 유무를 사전에 체크하여 유효한 데이터만 선별하며, `utf-8-sig` 인코딩을 적용하여 분석 환경에 관계없이 한글 깨짐 없는 데이터셋을 제공합니다.

### 🔍 전처리 예시 (Pre-processing Example)

프로젝트의 전처리 로직을 거치면 데이터가 다음과 같이 정제됩니다.

* **Before (Raw)**: `[앵커] 오늘 날씨가 매우 화창합니다. (서울=뉴스1) 김철수 기자 abc@news.com <저작권자(c) 뉴스1, 무단 전재-재배포 금지>`
* **After (Cleaned)**: `오늘 날씨가 매우 화창합니다.` (LLM 분석을 방해하는 방송 태그, 기자 정보, 저작권 문구 및 불필요한 공백이 모두 제거된 순수 본문)

## 🛠️ 설치 및 실행 방법 (Installation & Usage)

### 1. 환경 설정
이 프로젝트는 **Python 3.12** 및 **Airflow 2.10.2** 환경에서 테스트되었습니다.

```bash
# 1. 가상환경 생성 및 활성화
python -m venv airflow_env
source airflow_env/bin/activate

# 2. 필수 패키지 설치 (Airflow 버전 제약조건 포함)
# 주의: Python 3.12 호환성을 위해 constraints 파일을 반드시 함께 사용해야 합니다.
pip install -r requirements.txt --constraint "https://raw.githubusercontent.com/apache/airflow/constraints-2.10.2/constraints-3.12.txt"
```

### 2. Airflow 실행
프로젝트 루트 경로에서 Airflow를 실행합니다.

```bash
# 1. 현재 폴더를 Airflow 홈으로 설정 (필수)
export AIRFLOW_HOME=$(pwd)

# 2. Airflow 실행 (Webserver, Scheduler, Database 동시 실행)
airflow standalone
```

### 3. DAG 활성화 및 데이터 확인
1.  **웹 접속**: 브라우저에서 `http://localhost:8080` 접속
2.  **로그인**: 터미널 로그에 출력된 `admin` / `password` 확인 (또는 `standalone_admin_password.txt` 파일 확인)
3.  **DAG 켜기**: **`politics_news_daily`** DAG를 찾아 좌측의 **Toggle 스위치**를 `ON`으로 변경
4.  **결과 확인**: `data/` 폴더에 `naver_politics_YYYYMMDD.csv` 파일이 생성되는지 확인

## 📊 수집 데이터 명세 (Data Schema)

수집된 CSV 파일은 다음과 같은 컬럼을 포함합니다.

| 컬럼명 | 설명 | 예시 |
| :--- | :--- | :--- |
| **news_id** | 뉴스 고유 ID (oid-aid 또는 path 기반) | `001-0012345678` |
| **작성일시** | 기사 작성 시간 | `2026-01-26 10:30:01` |
| **수정일시** | 기사 수정 시간 (없으면 빈칸) | `2026-01-26 11:00:00` |
| **언론사** | 뉴스를 발행한 언론사 | `연합뉴스` |
| **기자명** | 기사를 작성한 기자 | `홍길동 기자` |
| **제목** | 뉴스 기사 제목 | `정치 관련 주요 뉴스 제목...` |
| **본문** | 기사 내용 (전처리 완료) | `(서울=연합뉴스) ...` |
| **이미지URL** | 기사 대표 이미지 주소 | `https://imgnews...` |
| **원문링크** | 언론사 원문 페이지 링크 | `http://...` |
| **네이버링크** | 네이버 뉴스 페이지 링크 | `https://n.news.naver.com...` |

## ⚙️ 설정 정보 (Configuration)

* **수집 대상**: 네이버 뉴스 > 정치(Politics) 섹션 (`sid1=100`)
* **시작 날짜 (`start_date`)**: 2026년 1월 26일
    * *변경 방법: `dags/politics_news_dag.py` 내 `default_args` 수정*
* **저장 경로**: `./data/`

## 👨‍💻 작성자 (Author)

* **Shinji** 